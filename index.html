<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- SEO 优化 -->
    <title>在线图片处理工具 - 免费图片格式转换、水印添加、批量处理</title>
    <meta name="description"
        content="免费在线图片处理工具，支持JPEG、PNG、WEBP、BMP格式转换，批量添加文字水印、图片水印，图片旋转翻转等功能。无需安装软件，浏览器直接使用，支持离线操作。">
    <meta name="keywords" content="图片格式转换,在线图片处理,批量图片处理,添加水印,图片压缩,JPEG转PNG,WEBP转换,免费图片工具">
    <meta name="author" content="图片处理工具">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://yoursite.com/">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://yoursite.com/">
    <meta property="og:title" content="在线图片处理工具 - 免费图片格式转换、水印添加">
    <meta property="og:description" content="免费在线图片处理工具，支持多种格式转换和批量处理，无需安装软件。">
    <meta property="og:image" content="https://yoursite.com/assets/icons/icon-512x512.png">
    <meta property="og:image:width" content="512">
    <meta property="og:image:height" content="512">
    <meta property="og:locale" content="zh_CN">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://yoursite.com/">
    <meta property="twitter:title" content="在线图片处理工具 - 免费图片格式转换、水印添加">
    <meta property="twitter:description" content="免费在线图片处理工具，支持多种格式转换和批量处理，无需安装软件。">
    <meta property="twitter:image" content="https://yoursite.com/assets/icons/icon-512x512.png">

    <!-- PWA 支持 -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#007bff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="图片处理工具">
    <link rel="apple-touch-icon" href="assets/icons/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/icons/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/icons/icon-16x16.png">

    <!-- 样式表 -->
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/responsive.css">

    <!-- 结构化数据 -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "图片处理工具",
        "description": "免费在线图片处理工具，支持JPEG、PNG、WEBP、BMP格式转换，批量添加文字水印、图片水印，图片旋转翻转等功能。无需安装软件，浏览器直接使用，支持离线操作。",
        "url": "https://yoursite.com/",
        "applicationCategory": "DesignApplication",
        "operatingSystem": "Any",
        "permissions": "browser",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        },
        "featureList": [
            "图片格式转换",
            "批量图片处理",
            "添加文字水印",
            "添加图片水印",
            "图片旋转翻转",
            "离线使用",
            "免费使用"
        ],
        "screenshot": "https://yoursite.com/assets/screenshots/desktop.png",
        "softwareVersion": "1.0.0",
        "author": {
            "@type": "Organization",
            "name": "图片处理工具团队"
        },
        "browserRequirements": "Modern browser with HTML5 Canvas support",
        "memoryRequirements": "512MB",
        "processorRequirements": "Any"
    }
    </script>
</head>

<body>
    <!-- 导航栏 -->
    <header class="header">
        <div class="container">
            <h1 class="logo">📸 图片处理工具</h1>
            <div class="header-info">
                <span id="imageCount">0 张图片</span>
            </div>
        </div>
    </header>

    <main class="main">
        <div class="container">
            <!-- 上传区域 -->
            <section class="upload-section">
                <div class="upload-area" id="uploadArea">
                    <div class="upload-content">
                        <h3>拖拽图片到此处或点击选择</h3>
                        <p>支持 JPG、PNG、GIF、WEBP、BMP 格式</p>
                        <button class="btn btn-primary" id="selectFilesBtn">选择图片</button>
                    </div>
                    <input type="file" id="fileInput" multiple accept="image/*" style="display: none;">
                </div>
            </section>

            <!-- 工具栏 -->
            <section class="toolbar" id="toolbar" style="display: none;">
                <div class="toolbar-left">
                    <button class="btn btn-secondary" id="selectAllBtn">全选</button>
                    <button class="btn btn-danger" id="deleteBtn">删除</button>
                    <span class="separator">|</span>
                    <button class="btn btn-secondary" id="rotateLeftBtn">↶ 左转</button>
                    <button class="btn btn-secondary" id="rotateRightBtn">↷ 右转</button>
                    <button class="btn btn-secondary" id="flipHBtn">⇄ 水平翻转</button>
                    <button class="btn btn-secondary" id="flipVBtn">⇅ 垂直翻转</button>
                    <button class="btn btn-secondary" id="resetBtn">↺ 重置</button>
                </div>
                <div class="toolbar-right">
                    <button class="btn btn-success" id="downloadBtn">📥 下载</button>
                </div>
            </section>

            <!-- 主内容区域 -->
            <section class="content-area">
                <!-- 图片网格 -->
                <div class="images-container">
                    <div class="images-grid" id="imagesGrid">
                        <!-- 动态生成的图片项 -->
                    </div>
                </div>

                <!-- 侧边操作面板 -->
                <aside class="side-panel" id="sidePanel">
                    <div class="panel-header">
                        <h3>操作面板</h3>
                        <span class="selected-count" id="selectedCount">未选择图片</span>
                    </div>

                    <!-- 格式转换 -->
                    <div class="panel-section">
                        <h4>🔄 格式转换</h4>
                        <div class="format-controls">
                            <label>目标格式:</label>
                            <select id="targetFormat">
                                <option value="jpeg">JPEG</option>
                                <option value="png">PNG</option>
                                <option value="webp">WEBP</option>
                                <option value="bmp">BMP</option>
                            </select>

                            <div class="quality-control" id="qualityControl">
                                <label>质量: <span id="qualityValue">90</span>%</label>
                                <input type="range" id="qualitySlider" min="10" max="100" value="90">
                            </div>

                            <button class="btn btn-primary btn-full" id="convertBtn">转换格式</button>
                        </div>
                    </div>

                    <!-- 水印设置 -->
                    <div class="panel-section">
                        <h4>🏷️ 水印设置</h4>
                        <div class="watermark-controls">
                            <div class="watermark-type">
                                <label>
                                    <input type="radio" name="watermarkType" value="text" checked> 文字水印
                                </label>
                                <label>
                                    <input type="radio" name="watermarkType" value="image"> 图片水印
                                </label>
                            </div>

                            <!-- 文字水印设置 -->
                            <div class="text-watermark" id="textWatermark">
                                <input type="text" id="watermarkText" placeholder="输入水印文字" value="Sample Watermark">

                                <div class="watermark-style">
                                    <label>字体大小:</label>
                                    <input type="range" id="fontSize" min="12" max="72" value="24">
                                    <span id="fontSizeValue">24px</span>
                                </div>

                                <div class="watermark-style">
                                    <label>颜色:</label>
                                    <input type="color" id="fontColor" value="#ff8200">
                                </div>

                                <div class="watermark-style">
                                    <label>透明度:</label>
                                    <input type="range" id="watermarkOpacity" min="0" max="100" value="80">
                                    <span id="opacityValue">80%</span>
                                </div>
                            </div>

                            <!-- 图片水印设置 -->
                            <div class="image-watermark" id="imageWatermark" style="display: none;">
                                <input type="file" id="watermarkImageInput" accept="image/*">
                                <div class="watermark-style">
                                    <label>透明度:</label>
                                    <input type="range" id="watermarkImageOpacity" min="0" max="100" value="80">
                                    <span id="imageOpacityValue">80%</span>
                                </div>
                            </div>

                            <!-- 位置选择 -->
                            <div class="position-grid">
                                <label>位置:</label>
                                <div class="position-selector">
                                    <button class="position-btn" data-position="top-left">↖</button>
                                    <button class="position-btn" data-position="top-center">↑</button>
                                    <button class="position-btn" data-position="top-right">↗</button>
                                    <button class="position-btn" data-position="middle-left">←</button>
                                    <button class="position-btn active" data-position="center">●</button>
                                    <button class="position-btn" data-position="middle-right">→</button>
                                    <button class="position-btn" data-position="bottom-left">↙</button>
                                    <button class="position-btn" data-position="bottom-center">↓</button>
                                    <button class="position-btn" data-position="bottom-right">↘</button>
                                </div>
                            </div>



                            <button class="btn btn-primary btn-full" id="applyWatermarkBtn">应用水印</button>
                        </div>
                    </div>
                </aside>
            </section>
        </div>
    </main>

    <!-- 图片预览模态窗口 -->
    <div class="modal" id="previewModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="previewTitle">图片预览</h3>
                <button class="modal-close" id="closePreview">&times;</button>
            </div>
            <div class="modal-body">
                <img id="previewImage" src="" alt="预览图片">
                <div class="image-info" id="imageInfo">
                    <p><strong>文件名:</strong> <span id="infoName">-</span></p>
                    <p><strong>尺寸:</strong> <span id="infoDimensions">-</span></p>
                    <p><strong>大小:</strong> <span id="infoSize">-</span></p>
                    <p><strong>格式:</strong> <span id="infoFormat">-</span></p>
                </div>
            </div>
        </div>
    </div>

    <!-- 进度条 -->
    <div class="progress-overlay" id="progressOverlay">
        <div class="progress-modal">
            <h3>处理中...</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <p id="progressText">正在处理图片 1/10</p>
        </div>
    </div>

    <!-- PWA 安装提示 -->
    <div class="install-prompt" id="installPrompt">
        <div class="install-content">
            <div class="install-icon">📱</div>
            <div class="install-text">
                <h4>安装为APP</h4>
                <p>将图片处理工具安装到设备，享受离线使用体验</p>
            </div>
            <div class="install-actions">
                <button class="btn btn-primary" id="installBtn">安装</button>
                <button class="btn btn-secondary" id="dismissBtn">暂不</button>
            </div>
        </div>
    </div>

    <!-- PWA 更新提示 -->
    <div class="update-prompt" id="updatePrompt">
        <div class="update-content">
            <div class="update-icon">🔄</div>
            <div class="update-text">
                <h4>发现新版本</h4>
                <p>有新功能可用，是否立即更新？</p>
            </div>
            <div class="update-actions">
                <button class="btn btn-primary" id="updateBtn">更新</button>
                <button class="btn btn-secondary" id="laterBtn">稍后</button>
            </div>
        </div>
    </div>

    <!-- 加载 JSZip 库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <!-- PWA 和 Service Worker 初始化 -->
    <script>
        // Service Worker 注册
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('SW 注册成功:', registration);

                        // 检查更新
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    showUpdatePrompt();
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.log('SW 注册失败:', error);
                    });
            });
        }

        // PWA 安装提示
        let deferredPrompt;
        let installPromptShown = localStorage.getItem('installPromptShown') === 'true';

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;

            if (!installPromptShown) {
                setTimeout(() => {
                    showInstallPrompt();
                }, 3000); // 3秒后显示安装提示
            }
        });

        // 显示安装提示
        function showInstallPrompt() {
            const installPrompt = document.getElementById('installPrompt');
            if (installPrompt) {
                installPrompt.style.display = 'flex';
            }
        }

        // 显示更新提示
        function showUpdatePrompt() {
            const updatePrompt = document.getElementById('updatePrompt');
            if (updatePrompt) {
                updatePrompt.style.display = 'flex';
            }
        }

        // 安装按钮事件
        document.addEventListener('DOMContentLoaded', () => {
            const installBtn = document.getElementById('installBtn');
            const dismissBtn = document.getElementById('dismissBtn');
            const installPrompt = document.getElementById('installPrompt');

            if (installBtn) {
                installBtn.addEventListener('click', () => {
                    if (deferredPrompt) {
                        deferredPrompt.prompt();
                        deferredPrompt.userChoice.then((choiceResult) => {
                            if (choiceResult.outcome === 'accepted') {
                                console.log('用户接受安装');
                            }
                            deferredPrompt = null;
                        });
                    }
                    installPrompt.style.display = 'none';
                    localStorage.setItem('installPromptShown', 'true');
                });
            }

            if (dismissBtn) {
                dismissBtn.addEventListener('click', () => {
                    installPrompt.style.display = 'none';
                    localStorage.setItem('installPromptShown', 'true');
                });
            }

            // 更新按钮事件
            const updateBtn = document.getElementById('updateBtn');
            const laterBtn = document.getElementById('laterBtn');
            const updatePrompt = document.getElementById('updatePrompt');

            if (updateBtn) {
                updateBtn.addEventListener('click', () => {
                    if (navigator.serviceWorker.controller) {
                        navigator.serviceWorker.controller.postMessage({ type: 'SKIP_WAITING' });
                    }
                    window.location.reload();
                });
            }

            if (laterBtn) {
                laterBtn.addEventListener('click', () => {
                    updatePrompt.style.display = 'none';
                });
            }
        });

        // 监听安装完成事件
        window.addEventListener('appinstalled', (evt) => {
            console.log('PWA 安装成功');
            // 可以在这里添加安装成功的反馈
        });
    </script>

    <!-- 加载项目脚本 -->
    <script src="scripts/image-processor.js"></script>
    <script src="scripts/file-handler.js"></script>
    <script src="scripts/ui-components.js"></script>
    <script src="scripts/main.js"></script>
</body>

</html>